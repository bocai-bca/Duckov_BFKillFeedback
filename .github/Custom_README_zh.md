# 自定义参考文档
在首次运行过一次本模组后，你能够看到`Escape from Duckov/Duckov_Data/StreamingAssets/BFKillFeedback`目录，以下将该目录简称为`<配置目录>`。

> [!WARNING]
> 本模组会在加载资源时将资源持续保存在内存中，使用非常大体积的图片、音频资源，会为游戏性能以正比例带来负面影响，在极端情况下甚至会导致游戏崩溃等。

## 配置文件
配置文件的路径为`<配置目录>/config.json`。  
注意，修改值时必须确保值满足"内部映射类型"，否则本模组读取配置文件时可能会将该值视为非法而跳过载入。虽然Json规范并没有在数字类型上区分整数还是小数，但是在修改本配置文件时需要强调类型，例如希望对一个浮点型选项填写`1`时，需填写为`1.0`以确保强调数据类型为浮点型而非整型。
<details>

<summary>键值对详情表格</summary>

| 键名 | 详细描述 | 类型(内部映射类型) | 默认值 | 是否在ModConfig可用
| :--- | :--- | :---: | :---: | :---:
| `use_sfx_namespace` | 使用的音效命名空间，设定本模组加载的音效包的名称(关于音效包的更多详情请见下方的"自定义音效包"章节) | 字符串(`String`) | `"bf5"` | 是✅
| `volume` | 击杀音效音量，可填写一个`0.0`到`1.0`的浮点数 | 浮点型(`Float`) | `0.6` | 是✅
| `max_skull_count` | 最大骷髅头数，允许HUD上同时存在的骷髅头数量，当HUD上已达到该数量个骷髅头时仍然需要创建新骷髅头时，最旧的骷髅头将立即开始淡出，以压制HUD上同时存在的骷髅头数量 | 整型(`Integer`) | `10` | 否❌
| `enforce_max_skull_count` | 强制最大骷髅头数，允许HUD上同时存在的骷髅头数量的强制上限，当HUD上已达到该数量个骷髅头时将禁止新骷髅头的创建，以强制限制HUD上同时存在的骷髅头数量 | 整型(`Integer`) | `25` | 否❌
| `disable_icon` | 禁用图标，可填写`true`或`false`，为`true`时将不显示骷髅头 | 布尔型(`Boolean`) | `false` | 是✅
| `skull_fadein_seconds` | 骷髅头淡入时间(单位为秒)，设定骷髅头从被创建到完成淡入动画过程所需的秒数 | 浮点型(`Float`) | `0.4` | 否❌
| `skull_stay_seconds` | 骷髅头停留时间(单位为秒)，设定骷髅头从完成淡入动画到开始淡出动画过程所需等待的秒数 | 浮点型(`Float`) | `5.0` | 否❌
| `skull_fadeout_seconds` | 骷髅头淡出时间(单位为秒)，设定骷髅头从开始淡出动画到完成淡出动画过程所需的秒数 | 浮点型(`Float`) | `0.3` | 否❌
| `skull_spacing` | 骷髅头间距乘数(基于骷髅头图标宽度)，影响骷髅头向两侧周围推斥的间距空间的宽度，每两个停留状态的骷髅头的间距为`2 * skull_spacing * <骷髅头图标宽度>` | 浮点型(`Float`) | `0.125` | 否❌
| `skull_color` | 普通击杀骷髅头颜色，使用一个长度为8的字符串以十六进制RGBA的形式表示一个含透明度的颜色，该颜色将用于调制普通骷髅头纹理(`kill.png`) | 字符串(`String`) | `"FFFFFFD9"` | 否❌
| `headshot_skull_color` | 爆头击杀骷髅头颜色，使用一个长度为8的字符串以十六进制RGBA的形式表示一个含透明度的颜色，该颜色将用于调制爆头骷髅头纹理(`headkill.png`)和涟漪圆环纹理(`headkill_frame_bold.png`和`headkill_frame_thin.png`) | 字符串(`String`) | `"FF8C00D9"` | 否❌
| `headshot_ring_init_size_rate` | 爆头击杀涟漪圆环起始尺寸比率，影响的效果为涟漪圆环纹理(`headkill_frame_bold.png`和`headkill_frame_thin.png`)的本地缩放为`headshot_ring_init_size_rate + Clamp((skull_age - skull_fadein_seconds) / headshot_ring_stay_seconds, 0f, 1f) * (headshot_ring_max_size_rate - headshot_ring_init_size_rate)`。需要注意的是骷髅头在淡入动画阶段涟漪圆环纹理的本地缩放始终为零向量 | 浮点型(`Float`) | `0.75` | 否❌
| `headshot_ring_max_size_rate` | 爆头击杀涟漪圆环最大尺寸比率，影响的效果为涟漪圆环纹理(`headkill_frame_bold.png`和`headkill_frame_thin.png`)的本地缩放为`headshot_ring_init_size_rate + Clamp((skull_age - skull_fadein_seconds) / headshot_ring_stay_seconds, 0f, 1f) * (headshot_ring_max_size_rate - headshot_ring_init_size_rate)` | 浮点型(`Float`) | `6.0` | 否❌
| `headshot_ring_bold_alpha_decrease` | 爆头击杀涟漪的粗差分纹理的不透明度减值，影响的效果为涟漪粗差分纹理(`headkill_frame_bold.png`)的不透明度为`Clamp(headshot_skull_color.alpha * (1f - Clamp((skull_age - skull_fadein_seconds) / headshot_ring_stay_seconds, 0f, 1f)) - headshot_ring_bold_alpha_decrease, 0f, 1f)` | 浮点型(`Float`) | `0.4` | 否❌
| `headshot_ring_stay_seconds` | 爆头击杀涟漪的存在持续时间，影响涟漪圆环纹理从起始尺寸过渡到最大尺寸所需的时间，也就是本值越小涟漪动画速度越快 | 浮点型(`Float`) | `1.0` | 否❌
| `position_offset_x` | 本模组HUD整体在画面上的水平位置偏移乘数(基于窗口水平分辨率)，为`1.0`时HUD将向右偏移半个窗口，反之 | 浮点型(`Float`) | `0.0` | 是✅
| `position_offset_y` | 本模组HUD整体在画面上的垂直位置偏移乘数(基于窗口垂直分辨率)，为`1.0`时HUD将向上偏移半个窗口，反之 | 浮点型(`Float`) | `-0.6` | 是✅
| `scale` | 本模组HUD整体的缩放率 | 浮点型(`Float`) | `0.6` | 是✅
| `addition_scale` | 增量缩放，一种用于特殊用途的缩放功能，可填写`true`或`false`，为`true`时使本模组HUD在分辨率越高的屏幕上越小，反之 | 布尔型(`Boolean`) | `false` | 是✅
| `skull_scale_on_drop` | 骷髅头在创建时的缩放倍率，影响骷髅头纹理(`kill.png`和`headkill.png`)，影响的效果为骷髅头纹理在淡入动画阶段的本地缩放为`skull_scale_on_drop / Clamp(Clamp(skull_age / skull_fadein_seconds, 0f, 1f) * skull_scale_on_drop, 1f, skull_scale_on_drop)` | 浮点型(`Float`) | `2.0` | 否❌
| `disable_text` | 禁用击杀文本，可填写`true`或`false`，为`true`时不显示击杀文本 | 布尔型(`Boolean`) | `false` | 否❌
| `text_template` | 击杀文本格式化模板，用于设定击杀文本的显示格式，包含5个格式化参数，每个格式化参数使用`{x}`代表，其中`x`为该格式化参数的0-based索引数。格式化参数分别为：被击杀敌人的显示名称(文本)，该种敌人在当次探索被击杀的计数(数字)，玩家使用的武器(文本)，玩家与被击杀敌人的距离(数字)，玩家击杀该敌人所收获的经验值(数字) | 字符串(`String`) | `"{0}#{1}[{2}]{3}m +{4}"` | 否❌
| `text_color` | 击杀文本颜色，使用一个长度为8的字符串以十六进制RGBA的形式表示一个含透明度的颜色 | 字符串(`String`) | `"FFFFFFD9"` | 否❌
| `text_position_offset_x` | 击杀文本的水平位置偏移乘数(基于窗口水平分辨率)，原点为整体的水平位置，为`1.0`时将向右偏移半个窗口，反之 | 浮点型(`Float`) | `0.0` | 否❌
| `text_position_offset_y` | 击杀文本的垂直位置偏移乘数(基于窗口垂直分辨率)，原点为整体的垂直位置，为`1.0`时将向上偏移半个窗口，反之 | 浮点型(`Float`) | `-0.175` | 否❌
| `text_scale` | 击杀文本缩放率，基于整体缩放率 | 浮点型(`Float`) | `1.0` | 否❌
| `text_stay_seconds` | 每条击杀文本的停留时间(单位为秒) | 浮点型(`Float`) | `2.0` | 否❌
| `text_memory_length` | 排队待显示的击杀文本存储条数上限，超出此数时不会记录新的击杀文本 | 整型(`Integer`) | `30` | 否❌
| `text_fade_seconds` | 击杀文本的淡入或淡出动画时间(单位为秒) | 浮点型(`Float`) | `0.25` | 否❌
| `disable_score` | 禁用分数显示，可填写`true`或`false`，为`true`时不显示分数 | 布尔型(`Boolean`) | `false` | 否❌
| `score_color` | 分数文本颜色，使用一个长度为8的字符串以十六进制RGBA的形式表示一个含透明度的颜色 | 字符串(`String`) | `"FFFFFFD9"` | 否❌
| `score_text_position_offset_x` | 分数文本的水平位置偏移乘数(基于窗口水平分辨率)，原点为整体的水平位置，为`1.0`时将向右偏移半个窗口，反之 | 浮点型(`Float`) | `0.0` | 否❌
| `score_text_position_offset_y` | 分数文本的垂直位置偏移乘数(基于窗口垂直分辨率)，原点为整体的垂直位置，为`1.0`时将向上偏移半个窗口，反之 | 浮点型(`Float`) | `-0.3` | 否❌
| `score_scale` | 分数文本缩放率，基于整体缩放率 | 浮点型(`Float`) | `2.5` | 否❌
| `score_text_number_increase_per_second` | 分数数字增加速度(单位为秒)，此数字越高，分数数字提升速度越快，分数数字在提升过程中不会开始进行停留时间计时，因此调整此数值也能变相地延长或缩短单次连杀分数持续时间 | 整型(`Integer`) | `200` | 否❌
| `score_text_stay_seconds` | 分数文本持续时间(单位为秒)，从分数数字达到当前取得的分数开始计时，计时达到后分数文本开始隐去，当分数文本完全隐去后，下次亮起时分数数字会重置为0 | 浮点型(`Float`) | `7.0` | 否❌
| `hide_reload_progress_bar` | 隐藏换弹进度条，可填写`true`或`false`，为`true`时将隐藏HUD下方的换弹进度条(不影响其他动作的进度条，如吃喝、治疗等) | 布尔型(`Boolean`) | `true` | 是✅
| `disable_vanilla_kill_feedback_sound` | 禁用原版击杀音效，可填写`true`或`false`，为`true`时将拦截原版的击杀反馈音效 | 布尔型(`Boolean`) | `false` | 否❌

</details>

## 自定义音效包

### 认识并创建音效命名空间
放置音效命名空间的目录为`<配置目录>/AudioNamespaces`，在该目录下创建一个目录，即视为创建了一个音效命名空间(可理解为音效包)，新创建的音效命名空间(就是音效包名称)即为该目录的名称。  
举个例子，本模组原厂包含两个音效命名空间，分别是`bf1`和`bf5`，在它俩旁边再创个目录，比如起个名字叫`114514`，你就是创建了一个名为`114514`的音效命名空间，或称之为名为`114514`的音效包。

### 往音效命名空间中添加音频
本模组只接受`.wav`格式音频文件，往音效命名空间目录中添加音频文件即视为给该音效命名空间添加音频，但是需要注意的是音频文件的名称将决定该音频如何被本模组使用，请耐心阅读下文。

### 音频名称、音效类型与回退机制
**音效类型**和**回退机制**是本模组的音频替换功能得以称之为"精心设计"的主要理由，该机制能够允许您仅通过使用特定文件名就实现一定程度上的复杂音效逻辑控制，而不需要涉及代码编写等门槛稍高的操作。  

本模组根据击杀敌人的方式/特点，为自定义玩家提供了以下的**音效类型**：
- 普通枪械击杀
- 爆头枪械击杀
- 一发秒爆头枪械击杀
- 近战击杀
- 暴击近战击杀
- 一刀秒近战击杀
- 爆炸击杀
- 一发秒爆炸击杀
- 玩家自己死掉

上述提到的所有音效类型都是您可利用的，音效类型在字面上就已向您表示了该音效对应的触发方式。

#### 回退是什么

简而言之类似于一种反向的"优先级"规则。

当触发了一种音效类型时，本模组首先会尝试在对应的音效类型的音效池中选取一个音效进行播放，而如果当前加载的音效命名空间中没有为该音效类型添加任何一个音效，那么本模组会尝试进行回退到该音效类型的回退类型。  
这种回退是循环的，如果音效类型之间形成了一个回退链，那么是有可能进行很多次回退，最终直到到达无回退的音效类型时，如果仍未能选取到一个可播放的音效，那么将取消此次音效播放。  

举个例子：  
假如我们用大狙一发秒了一个敌人，那么很显然会触发"一发秒爆头枪械击杀"这个音效类型，而如果当前加载的音效命名空间并未给"一发秒爆头枪械击杀"这个音效类型添加音效，则本模组会尝试回退到"爆头枪械击杀"这个音效类型的音效池中选取音效。然后又很不巧地，如果"爆头枪械击杀"也没有音效可以用，那么本模组会继续尝试回退，来到"普通枪械击杀"这个音效类型中选取音效。

#### 为音频文件命名

搞懂音效类型与回退机制以后，我们可以开始着手给手里的音频文件命名了。每个音频文件的名称格式是`<音效类型名称>_<序号>.wav`，如`kill_0.wav`、`meleekill_2.wav`等。

各音效类型对应的名称如下：
| 音效类型人话 | 音效类型名称 | 回退类型人话 | 回退类型名称
| :---: | :---: | :---: | :---:
| 普通枪械击杀 | `kill` | 无 | 无
| 爆头枪械击杀 | `headkill` | 普通枪械击杀 | `kill`
| 一发秒爆头枪械击杀 | `oneshotheadkill` | 爆头枪械击杀 | `headkill`
| 近战击杀 | `meleekill` | 普通枪械击杀 | `kill`
| 暴击近战击杀 | `critmeleekill` | 近战击杀 | `meleekill`
| 一刀秒近战击杀 | `onemeleekill` | 暴击近战击杀 / 近战击杀(无暴击时) | `critmeleekill` / `meleekill`(无暴击时)
| 爆炸击杀 | `explosionkill` | 普通枪械击杀 | `kill`
| 一发秒爆炸击杀 | `oneexplosionkill` | 爆炸击杀 | `explosionkill`
| 玩家自己死掉 | `death` | 无 | 无

每一种音效类型都可以添加任意个音频文件，本模组在加载音效命名空间时会按**0-Based**、**连续的**序号顺序扫描每种音效类型的每个音频文件。举个例子，假如命名空间目录中有以下音频文件：
`kill_0.wav`
`kill_1.wav`
`kill_3.wav`
`death_1.wav`
`death_2.wav`
那么，`kill`的`0`、`1`会被加载，但由于`3`前面没有一个连续的`2`存在，所以`3`不会被加载，另外两个`death`则一个都不会被加载，因为没有`0`存在，`1`前面不连续，`2`的话毕竟`1`都没加载就更不用说了。

### 使用和分享音效包

在配置文件中将`use_sfx_namespace`的值设为想要加载的命名空间即可，例如刚刚举例的`114514`。如果同时安装了[ModConfig](https://steamcommunity.com/sharedfiles/filedetails/?id=3590674339)，还可享受到在游戏过程中随时在设置中切换音效包的功能(切换的瞬间会卡一下，因为本模组采用的是同步加载)。

既然您已经做到了这一步，想必您应该知道如何将您制作的音效包分享给其他人了。只需将您的音效命名空间打包，将文件通过任意方式传播到他人手中后，指导他人将音效命名空间目录(需要是目录，不能是压缩包形态)放置在`<配置目录>/AudioNamespaces`中即可。

## 图像替换

放置图像的目录为`<配置目录>/Icons`，在这里可以放置四个特定名称的`.png`图片文件以覆盖本模组的原厂击杀图标纹理。
分别是：
- `kill.png`，普通击杀骷髅头
- `headkill.png`，爆头击杀骷髅头
- `headkill_frame_bold.png`，爆头骷髅头涟漪粗框差分
- `headkill_frame_thin.png`，爆头骷髅头涟漪细框差分

通常只推荐使用灰度图片(没有色相、饱和度等属性的、只有HSL中的L的图片)，因为骷髅头的颜色将通过配置文件的颜色对纹理图进行调制而成。如果希望使用彩色图片而不希望本模组的颜色调制功能干预，可在配置文件中将`skull_color`和`headshot_skull_color`选项的RGB段设为`FFFFFF`，而如果不希望本模组主动为图标降低不透明度，则可将这两项的A段设为`FF`。